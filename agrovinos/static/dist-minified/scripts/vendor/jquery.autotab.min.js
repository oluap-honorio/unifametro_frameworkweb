/**
 * Autotab - jQuery plugin 1.5b
 * https://github.com/Mathachew/jquery-autotab
 * 
 * Copyright (c) 2013 Matthew Miller
 * 
 * Licensed under the MIT licensing:
 *   http://www.opensource.org/licenses/mit-license.php
 */

(function(e){var h=navigator.platform,d={tabPause:800,focusChange:null,iOS:"iPad"===h||"iPhone"===h||"iPod"===h,firefox:"undefined"!==typeof InstallTrigger},m=function(a,c){if(null!==c&&"undefined"!==typeof c)for(var b in c)e(a).data("autotab-"+b,c[b])},l=function(a){var c={format:"all",loaded:!1,disabled:!1,pattern:null,uppercase:!1,lowercase:!1,nospace:!1,maxlength:2147483647,target:null,previous:null,trigger:null},b;for(b in c)c[b]=e(a).data("autotab-"+b)||c[b];c.loaded||(null!==c.trigger&&"string"===
typeof c.trigger&&(c.trigger=c.trigger.toString()),m(a,c));return c};e.autotab={next:function(){var a=e(document.activeElement);a.length&&setTimeout(function(){a.trigger("autotab-next")},1)},previous:function(){var a=e(document.activeElement);a.length&&setTimeout(function(){a.trigger("autotab-previous")},1)}};e.fn.autotab=function(a,c){if(!this.length)return this;if("filter"==a){if("string"===typeof c||"function"===typeof c)c={format:c};for(var b=0,d=this.length;b<d;b++){var g=l(this[b]),k=c;k.target=
g.target;k.previous=g.previous;e.extend(g,k);m(this[b],g)}}else if("remove"==a||"destroy"==a||"disable"==a)for(b=0,d=this.length;b<d;b++)g=l(this[b]),g.disabled=!0,m(this[b],g);else if("restore"==a||"enable"==a)for(b=0,d=this.length;b<d;b++)g=l(this[b]),g.disabled=!1,m(this[b],g);else if(null===a||"undefined"===typeof a?c={}:"string"===typeof a||"function"===typeof a?c={format:a}:"object"===typeof a&&(c=a),1<this.length)for(b=0,d=this.length;b<d;b++){var g=b+1,q=b-1,k=c;0<b&&g<d?(k.target=this[g],
k.previous=this[q]):0<b?(k.target=null,k.previous=this[q]):(k.target=this[g],k.previous=null);r(this[b],k)}else r(this[0],c);return this};var p=function(a,c,b){if("function"===typeof b.format)return b.format(c,a);a=null;switch(b.format){case "text":a=RegExp("[0-9]+","g");break;case "alpha":a=RegExp("[^a-zA-Z]+","g");break;case "number":case "numeric":a=RegExp("[^0-9]+","g");break;case "alphanumeric":a=RegExp("[^0-9a-zA-Z]+","g");break;case "hex":case "hexadecimal":a=RegExp("[^0-9A-Fa-f]+","g");break;
case "custom":a=RegExp(b.pattern,"g")}null!==a&&(c=c.replace(a,""));b.nospace&&(a=RegExp("[ ]+","g"),c=c.replace(a,""));b.uppercase&&(c=c.toUpperCase());b.lowercase&&(c=c.toLowerCase());return c},r=function(a,c){var b=l(a);b.disabled&&(b.disabled=!1,b.target=null,b.previous=null);e.extend(b,c);"string"!==typeof b.target&&b.target instanceof jQuery||(b.target=e(b.target));"string"!==typeof b.previous&&b.previous instanceof jQuery||(b.previous=e(b.previous));var h=a.maxLength;2147483647==b.maxlength&&
2147483647!=h?b.maxlength=h:0<b.maxlength?a.maxLength=b.maxlength:b.target=null;d.loaded?m(a,b):(b.loaded=!0,m(a,b),e(a).on("autotab-next",function(b,a){a||(a=l(this));a.disabled||!a.target.length||d.iOS||(a.target.focus().select(),d.focusChange=new Date)}).on("autotab-previous",function(b,a){a||(a=l(this));if(!a.disabled&&a.previous.length){a.previous.focus();if(d.firefox){var c=a.previous.val().length;a.previous[0].setSelectionRange(c,c)}else a.previous.val(a.previous.val());d.focusChange=null}}).on("keydown",
function(a){var b=l(this);if(!b||b.disabled)return!0;var c=a.which||a.charCode;if(8==c&&0===this.value.length&&b.previous.length)e(this).trigger("autotab-previous",b);else if(9==c&&null!==d.focusChange)if(a.shiftKey)d.focusChange=null;else if((new Date).getTime()-d.focusChange.getTime()<d.tabPause)return d.focusChange=null,!1}).on("keypress",function(a){var b=l(this);if(!b||b.disabled||d.firefox&&0===a.charCode||a.ctrlKey||a.altKey)return!0;var c=String.fromCharCode(a.which||a.keyCode);if(null!==
b.trigger&&0<=b.trigger.indexOf(c))return null!==d.focusChange&&(new Date).getTime()-d.focusChange.getTime()<d.tabPause?d.focusChange=null:e(this).trigger("autotab-next",b),!1;d.focusChange=null;a=document.selection&&document.selection.createRange?!0:0<a.charCode;c=p(this,c,b);if(a&&(null===c||""===c))return!1;if(a&&this.value.length<=this.maxLength){var f;if("number"===typeof this.selectionStart&&"number"===typeof this.selectionEnd){f=this.selectionStart;a=this.selectionEnd;if(0===f&&a==this.value.length)this.value=
c;else{if(this.value.length==this.maxLength)return e(this).trigger("autotab-next",b),!1;this.value=this.value.slice(0,f)+c+this.value.slice(a)}this.selectionStart=this.selectionEnd=f+1}else if(document.selection&&document.selection.createRange){a=document.selection.createRange();var n=this.createTextRange();f=this.createTextRange();var h=a.getBookmark();n.moveToBookmark(h);f.setEndPoint("EndToStart",n);f=f.text.length;a=f+a.text.length;if(0===f&&a==this.value.length)this.value=c;else{if(this.value.length==
this.maxLength)return e(this).trigger("autotab-next",b),!1;this.value=this.value.slice(0,f)+c+this.value.slice(a)}f++;n=this.createTextRange();n.collapse(!0);n.move("character",f-(this.value.slice(0,f).split("\r\n").length-1));n.select()}}this.value.length==b.maxlength&&e(this).trigger("autotab-next",b);return!1}).on("paste",function(a){var b=l(this);if(!b)return!0;this.maxLength=2147483647;(function(a,c){setTimeout(function(){var g=-1,h=document.createElement("input");h.type="hidden";h.value=a.value.toLowerCase();
a.maxLength=c.maxlength;a.value=p(a,a.value,c).substr(0,c.maxlength);var m=function(a,b){if(a){for(var c=0,f=b.length;c<f;c++)g=h.value.indexOf(b.charAt(c),g)+1;c=l(a);f=h.value.substr(g);(f=p(a,f,c).substr(0,c.maxlength))?(a.value=f,f.length==c.maxlength&&(e(a).trigger("autotab-next",c),d.iOS||m(c.target[0],f))):a.value=""}};a.value.length==c.maxlength&&(e(a).trigger("autotab-next",b),d.iOS||m(c.target[0],a.value.toLowerCase()))},1)})(this,b)}))};e.fn.autotab_magic=function(a){e(this).autotab()};
e.fn.autotab_filter=function(a){var c={};"string"===typeof a||"function"===typeof a?c.format=a:e.extend(c,a);e(this).autotab("filter",c)}})(jQuery);